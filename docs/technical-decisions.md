# 技術選定・判断事項

Voice-clone-Qwen3-TTS において、**既に決定済みの技術選定**と**未決定事項（開発者判断待ち）**を整理する。実装開始前に未決定事項を確定すること。

---

## 3.1 未決定事項（開発者に質問）

以下の 4 点は実装方針に直結するため、開発者の判断を仰ぐ。

---

### 1. 参照音声のテキスト（ref_text）取得方法

| 項目 | 内容 |
|------|------|
| **選択肢 A** | faster-whisper で参照音声を自動文字起こしし、ref_text として利用する |
| **選択肢 B** | あらかじめ用意したコーパステキスト（`data/corpus.txt` 等）を手動で使用する。録音時に「そのコーパスを読み上げた」前提で ref_text と一致させる |
| **推奨** | **B** |
| **推奨理由** | 確実性が高い。Qwen3-TTS は ref_text と ref_audio の内容が一致していることが重要。手動でコーパスを用意し、その通りに録音すれば一致を保証しやすい。初期段階ではシンプルで検証しやすい。 |
| **開発者の判断** | □ B を採用 |

---

### 2. Discord Bot の起動方法

| 項目 | 内容 |
|------|------|
| **選択肢 A** | `python -m src.bot.main` でスクリプトとして起動する |
| **選択肢 B** | systemd や supervisor でデーモン化し、常時起動する |
| **推奨** | **A** |
| **推奨理由** | 個人開発・開発環境での利用が主であるため、ターミナルから起動・停止できる方がデバッグしやすい。本番運用や常時起動が必要になった段階で B を検討すればよい。 |
| **開発者の判断** | □ A を採用 |

---

### 3. 音声ファイルの一時保存場所

| 項目 | 内容 |
|------|------|
| **選択肢 A** | システムの `/tmp/` ディレクトリ（Linux 標準の一時領域）に保存する |
| **選択肢 B** | プロジェクト内の `logs/temp_audio/`（または `logs/temp_audio/`）に保存する |
| **推奨** | **B** |
| **推奨理由** | ログと同様にプロジェクト配下で管理できる。デバッグ時に一時 WAV を確認しやすく、クリーンアップ方針も `logs/` 配下で統一できる。 |
| **開発者の判断** | □ B を採用 |

---

### 4. ボイスクローン用モデルのキャッシュ場所

| 項目 | 内容 |
|------|------|
| **選択肢 A** | Hugging Face のデフォルトキャッシュ（`~/.cache/huggingface/`）を使用する |
| **選択肢 B** | プロジェクト内の `models/` ディレクトリに明示的に保存する |
| **推奨** | **A** |
| **推奨理由** | Hugging Face 標準の挙動に合わせられる。他プロジェクトでも同じモデルを利用する場合にキャッシュを共有でき、ディスクの重複を避けられる。 |
| **開発者の判断** | □ A を採用 |

---

## 3.2 既に決定済みの事項

以下は要求定義・要件定義・環境構築の時点で確定している。

| 項目 | 決定内容 |
|------|----------|
| **言語・ランタイム** | Python 3.12 + venv |
| **Discord クライアント** | discord.py（Python） |
| **TTS モデル** | Qwen3-TTS-12Hz-1.7B-Base（Hugging Face） |
| **実行環境** | WSL2 / Ubuntu 24.04 |
| **GPU・フレームワーク** | CUDA 12.1 + PyTorch 2.5.1（または 2.x） |
| **音声サンプル形式** | 録音は MP3 等で保存し、Qwen3-TTS が対応する形式に変換して利用可能とする |
| **参照音声の用意** | 開発者がコーパステキストを読み上げて録音（NowSmart Audio Recorder 等）。ref_text は上記「未決定事項 1」の判断に従う |

---

## 3.3 判断後の反映

未決定事項を確定したら、以下に反映すること。

1. **設計・実装**  
   - `docs/architecture.md` の補足や `docs/api-design.md` の設定項目で、採用した選択肢を明記する。
2. **設定・コード**  
   - `src/config/settings.py` および一時ファイル保存先・モデルキャッシュ参照先の実装で、選択した方針を使う。
3. **ドキュメント**  
   - 本ファイルの「開発者の判断」欄にチェックを入れ、必要なら「その他」に具体的な方針を追記する。  
   - `logs/development-log.md` に「技術選定確定」の旨と採用内容を 1 行程度で記録する。

---

*実装は、上記未決定事項が開発者により承認・確定してから開始する。*
